<!DOCTYPE html>
<html>
  <head>
    <title>Raphexion Github Pages</title>
    <meta charset="UTF-8">

    <!-- highlight code -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/androidstudio.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <link rel="stylesheet" type="text/css" href="main.css">
    <script type="text/javascript" src="main.js"></script>
  </head>
  <body>
    <div class="circle left"></div>
    <div>
      <h1>Random small parts of knowledge</h1>
      Inspired by Barry Watson's <a href="http://www.barrywatson.se/lsi/index.html">page</a>.
      I hope to collect some notes about what I read and play around with.
    </div>
    <div>
      <h2>Embedded Systems</h2>
      <div class="note">
        <h3>ftdi usb-serial cable</h3>
      </div>
    </div>
    <div>
      <h2>General Programming</h2>
      <div class="note">
        <h3>C + Python + GDB</h3>
        <div>

          <h4>module.c</h4>
          <pre><code class="C">
#include "module.h"

int foo(int x, int y)
{
  x += 1;
  y += 2;

  return x + y;
}
          </code></pre>

          <h4>module.h</h4>
          <pre><code class="C">
#ifndef MODULE_H
#define MODULE_H

int foo(int x, int y);

#endif
          </code></pre>

          <h4>driver.py</h4>
          <pre><code class="python">
import ctypes

def main():
    module = ctypes.CDLL('./libmodule.so')
    module.foo.restype = int

    z = module.foo(1, 2)
    print(z)

if __name__ == '__main__':
    main()
          </code></pre>
        </div>

        <h4>Make a shared library to debug</h4>
        <pre><code class="bash">
gcc -c -Wall -Werror -fpic -ggdb module.c
gcc -shared -o libmodule.so module.o
        </code></pre>

        <h4>Run the program as normal</h4>
        <pre><code class="bash">
$ python driver.py
=> 6
        </code></pre>

        <h4>Step the C code with gdb</h4>
        <pre><code class="bash">
$ gdb python
(gdb)
(gdb) break foo
Function "foo" not defined.
Make breakpoint pending on future shared library load? (y or [n]) y
Breakpoint 1 (foo) pending.
(gdb)run driver.py
Starting program: /usr/bin/python driver.py
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".

Breakpoint 1, foo (x=1, y=2) at module.c:5
5	  x += 1;
(gdb) list
1	#include "module.h"
2
3	int foo(int x, int y)
4	{
5	  x += 1;
6	  y += 2;
7
8	  return x + y;
9	}
(gdb)
        </code></pre>
        <p>2016-04-20</p>
      </div>
    </div>
  </body>
</html>
